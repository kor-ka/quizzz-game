{"version":3,"sources":["model/GameModel.ts","model/SessionModel.ts","ui/ui.tsx","components/Scene.tsx","components/Controls.tsx","components/Helpers.ts","components/useAnimation.tsx","utils/hashCode.ts","utils/makeId.ts","components/SesssionComponent.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["GameModel","session","state","scores","Map","ttl","stack","setState","listeners","Set","listen","lsitener","add","delete","notify","forEach","l","handleEvent","event","notifyers","type","reverse","map","q","isCurretn","qid","question","_id","console","warn","active","completed","id","gid","user","users","get","uid","set","score","this","endpoint","window","location","hostname","indexOf","Emitter","socket","emit","message","JSON","stringify","SessionModel","io","usersListeners","sesssionState","sesssionStateListeners","myId","me","meListeners","isMobile","game","init","socketIo","transports","reconnectionAttempts","Number","MAX_SAFE_INTEGER","on","handleBatch","open","batchRaw","batch","parse","e","n","log","notifyUser","notifyMeUser","notifyState","subscribeUsers","listener","subscribeMeUser","subscribeSessionState","Cookie","split","chrome","FlexLayout","Glamorous","div","props","display","flexDirection","flexShrink","WebkitOverflowScrolling","boxSizing","style","marginLeft","undefined","divider","marginRight","marginTop","marginBottom","ButtonInner","minWidth","color","whiteSpace","fontSize","backgroundColor","padding","paddingTop","paddingBottom","justifyContent","borderRadius","cursor","textAlign","userSelect","outline","Button","className","onClick","children","Input","border","selected","input","minHeight","borderWidth","lineHeight","appearance","SceneContext","React","Scene","ref","scene","cam","renderer","frameId","minSceneCamZ","tickListeners","subscribeTicks","start","requestAnimationFrame","tick","stop","cancelAnimationFrame","renderScene","render","current","ReactDOM","width","clientWidth","height","clientHeight","THREE","position","z","y","light","target","antialias","setClearColor","setSize","appendChild","domElement","gridHelper","rotateX","Provider","value","innerWidth","innerHeight","SessionStateComponent","setTimeout","loading","setLoading","SessionContext","s","interval","setInterval","left","Date","getTime","clearInterval","startStop","zIndex","opacity","bottom","right","Math","floor","max","Profile","setMe","onChange","name","alignSelf","defaultValue","placeholder","AnswerText","answer","setAnsser","onPick","answers","a","AnswerOpen","Question","submited","setSubmited","onSubmit","pointerEvents","textAnswers","background","Game","offset","overflowY","flexGrow","key","getTextMesh","text","font","bold","x","canvas","document","createElement","devicePixelRatio","context","getContext","scale","maxWidth","fillStyle","fillRect","words","line","lines","realWidth","length","testLine","measureText","push","realMetrics","startY","startX","i","fillText","wrapText","texture","needsUpdate","minFilter","material","transparent","mesh","remove","interpolate","from","to","hashCode","h","charCodeAt","makeId","possible","charAt","random","SessionComponent","SceneRender","sessionState","update","size","sub1","sub2","u","top","GameCard","shape","moveTo","lineTo","absarc","degToRad","geometry","steps","depth","bevelEnabled","center","rotation","getCard","card","index","xTremor","positionTremor","yTremor","rotationTremor","zTremor","cardAnimatTo","end","animation","setAnimation","duration","now","clone","toVector3","rcb","BezierEasing","pcb","dispose","time","mu","pmu","rmu","useAnimation","vertAngle","fov","distanceV","base","tan","horisontalBase","aspect","horAngle","atan","distanveH","translateZ","targetPostion","Vector3","getWorldPosition","targetRotation","targetRotationVector","GameRender","cards","setCards","gs","res","category","toLocaleTimeString","c","createContext","App","pathname","filter","Boolean","match","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.41e002a8.chunk.js","sourcesContent":["import { Event } from '../../server/src/entity/events';\nimport { SessionModel } from './SessionModel';\nimport { ClientUser } from '../../server/src/user/User';\nimport { ClientQuestion, GameState as State } from '../../server/src/game/Game';\n\nexport interface GameState {\n    id?: string;\n    scores: Map<string, { user: ClientUser, score: number }>;\n    question?: ClientQuestion;\n    stack: { qid: string, category: string, question?: ClientQuestion, active: boolean }[]\n    state: State | 'wait';\n    ttl: number\n}\n\nexport class GameModel {\n    session: SessionModel;\n    constructor(session: SessionModel) {\n        this.session = session;\n    }\n\n    state: GameState = { scores: new Map(), state: 'wait', ttl: 0, stack: [] };\n    setState = (state: Partial<GameState>) => {\n        this.state = { ...this.state, ...state };\n    }\n    listeners = new Set<(state: GameState) => void>();\n\n    listen = (lsitener: (state: GameState) => void) => {\n        this.listeners.add(lsitener);\n        lsitener(this.state);\n        return () => {\n            this.listeners.delete(lsitener);\n        }\n    }\n\n    notify = () => {\n        this.listeners.forEach(l => l(this.state));\n    }\n\n\n    // TOOD create separate game states?\n    handleEvent = (event: Event, notifyers: Set<() => void>) => {\n        if (event.type === 'GameStateChangedEvent') {\n            event.stack.reverse();\n            let stack = event.stack.map(q => {\n                let isCurretn = q.qid === (event.question && event.question._id);\n                console.warn(q.qid, event.question && event.question._id);\n                if (isCurretn) {\n                    return { ...q, question: event.question, active: !q.completed };\n                } else {\n                    return { ...q, active: true };\n                }\n            });\n            this.setState({ id: event.gid, question: event.question, state: event.state, ttl: event.ttl || 0, stack });\n            notifyers.add(this.notify);\n        } else if (event.type === 'GameScoreChangedEvent') {\n            let user = this.session.users.get(event.uid);\n            if (user) {\n                this.state.scores.set(event.uid, { user, score: event.score })\n                this.setState({ scores: new Map(this.state.scores) });\n            }\n            notifyers.add(this.notify);\n        }\n    }\n\n}","import * as socketIo from 'socket.io-client';\nimport { Message } from '../../server/src/entity/messages';\nimport { ClientUser } from '../../server/src/user/User';\nimport { SessionState } from '../../server/src/session/Session';\nimport * as Cookie from 'js-cookie';\nimport { Event } from '../../server/src/entity/events';\nimport { GameModel } from './GameModel';\nexport const endpoint = window.location.hostname.indexOf('localhost') >= 0 ? 'http://localhost:5000' : '';\n\nclass Emitter {\n    socket: SocketIOClient.Socket;\n    constructor(socket: SocketIOClient.Socket) {\n        this.socket = socket;\n    }\n    emit = (message: Message) => {\n        this.socket.emit('message', JSON.stringify(message));\n    }\n}\n\nexport class SessionModel {\n    id: string;\n    io: Emitter;\n\n    users = new Map<string, ClientUser>();\n    usersListeners = new Set<(users: Map<string, ClientUser>) => void>();\n\n    sesssionState: { state: SessionState | 'connecting', ttl: number } = { state: 'connecting', ttl: 0 };\n    sesssionStateListeners = new Set<(sessionState: { state: SessionState | 'connecting', ttl: number }) => void>();\n\n    myId: string;\n    me?: ClientUser;\n    meListeners = new Set<(me: ClientUser) => void>();\n\n    isMobile?: boolean;\n\n    game = new GameModel(this);\n\n    constructor(id: string) {\n        this.id = id;\n        this.io = this.init();\n        this.myId = Cookie.get('quizzz-game-user')!.split(':')[0];\n\n        this.isMobile = Cookie.get('isMobile') === 'true';\n    }\n\n    init = () => {\n        let socket = socketIo(endpoint, { transports: ['websocket'], reconnectionAttempts: Number.MAX_SAFE_INTEGER });\n        let io = new Emitter(socket);\n        socket.on('event', this.handleBatch);\n        socket.on('connect', () => io.emit({ type: 'InitSession', id: this.id }));\n        socket.on('disconnect', socket.open)\n        socket.on('connect_error', socket.open)\n        socket.on('connect_timeout', socket.open)\n\n        return io;\n    }\n\n    handleBatch = (batchRaw: string) => {\n        let batch: { batch: Event[] } = JSON.parse(batchRaw);\n        let notifyers = new Set<() => void>();\n        batch.batch.forEach(e => this.handleEvent(e, notifyers));\n        notifyers.forEach(n => n());\n    }\n\n    handleEvent = (event: Event, notifyers: Set<() => void>) => {\n        console.log('[event]', event);\n        if (event.type === 'UserUpdatedEvent') {\n            this.users.set(event.user._id, event.user);\n            notifyers.add(this.notifyUser);\n            if (event.user._id === this.myId) {\n                this.me = event.user;\n                notifyers.add(this.notifyMeUser);\n            }\n        } else if (event.type === 'SessionUserJoinedEvent') {\n            this.users.set(event.user._id, event.user);\n            if (event.user._id === this.myId) {\n                this.me = event.user;\n                notifyers.add(this.notifyMeUser);\n            }\n            notifyers.add(this.notifyUser);\n        } else if (event.type === 'SessionUserLeftEvent') {\n            this.users.delete(event.user._id);\n            notifyers.add(this.notifyUser);\n        } else if (event.type === 'SessionStateChangedEvent') {\n            this.sesssionState = { state: event.state, ttl: event.ttl || 0 };\n            notifyers.add(this.notifyState);\n        }\n\n        this.game.handleEvent(event, notifyers);\n    }\n\n    ////\n    // io\n    ////\n\n    subscribeUsers = (listener: (users: Map<string, ClientUser>) => void) => {\n        this.usersListeners.add(listener);\n        listener(this.users);\n        return () => {\n            this.usersListeners.delete(listener);\n        }\n    }\n\n    subscribeMeUser = (listener: (me: ClientUser) => void) => {\n        this.meListeners.add(listener);\n        if (this.me) { listener(this.me); }\n        return () => {\n            this.meListeners.delete(listener);\n        }\n    }\n\n    subscribeSessionState = (listener: (state: { state: SessionState | 'connecting', ttl: number }) => void) => {\n        this.sesssionStateListeners.add(listener);\n        listener(this.sesssionState);\n        return () => {\n            this.sesssionStateListeners.delete(listener);\n        }\n    }\n\n    notifyUser = () => {\n        this.usersListeners.forEach(l => l(new Map(this.users)));\n        console.log('[session]', 'new users', this.users);\n\n    }\n\n    notifyMeUser = () => {\n        this.meListeners.forEach(l => l({ ...this.me! }));\n        console.log('[session]', 'new me', this.me);\n    }\n\n    notifyState = () => {\n        this.sesssionStateListeners.forEach(l => l({ ...this.sesssionState }));\n        console.log('[session]', 'new state', this.sesssionState);\n    }\n}","import * as React from \"react\";\nimport Glamorous from \"glamorous\";\nexport const isChromium = (window as any).chrome;\n\nexport const FlexLayout = Glamorous.div<{\n    divider?: number;\n    style?: React.CSSProperties;\n}>(props => ({\n    display: \"flex\",\n    flexDirection: \"column\",\n    flexShrink: 0,\n    WebkitOverflowScrolling: \"touch\",\n    boxSizing: \"border-box\",\n    \"> *\": props.style && props.style.flexDirection === 'row' ? {\n        marginLeft: props.divider !== undefined ? props.divider : 5,\n        marginRight: props.divider !== undefined ? props.divider : 5\n    } : {\n            marginTop: props.divider !== undefined ? props.divider : 5,\n            marginBottom: props.divider !== undefined ? props.divider : 5\n        },\n    \">:first-child\": props.style && props.style.flexDirection === 'row' ? {\n        marginLeft: 0\n    } : {\n            marginTop: 0\n        },\n    \">:last-child\": props.style && props.style.flexDirection === 'row' ? {\n        marginRight: 0\n    } : {\n            marginBottom: 0\n        },\n    ...props.style\n}));\n\nexport const Landscape = Glamorous.div({\n    '@media only screen and (orientation: portrait)': {\n        display: 'none',\n    }\n});\n\nexport const Portrait = Glamorous.div({\n    '@media only screen and (orientation: landscape)': {\n        display: 'none',\n    }\n});\n\nconst ButtonInner = Glamorous.div<{ type?: 'danger' }>((props) => ({\n    minWidth: 28,\n    color: 'black',\n    whiteSpace: 'pre-wrap',\n    fontSize: '16px',\n    backgroundColor: props.type === 'danger' ? 'rgba(250, 200, 200, 0.6)' : 'rgba(250, 250, 250, 0.6)',\n    padding: 1,\n    paddingTop: 11,\n    paddingBottom: 9,\n    display: 'flex',\n    flexDirection: 'column',\n    justifyContent: 'center',\n    borderRadius: 10,\n    cursor: 'pointer',\n    textAlign: 'center',\n    userSelect: 'none',\n\n    ':focus': {\n        outline: 0\n    },\n\n}));\n\nexport const Button = (props: { className?: string, style?: React.CSSProperties, onClick?: () => void, type?: 'danger', children?: any }) => <ButtonInner type={props.type} className={props.className} style={props.style} onClick={props.onClick}>{props.children}</ButtonInner>\n\nexport const TextContentStyled = Glamorous.div<{ selected?: boolean }>(\n    props => ({\n        whiteSpace: \"pre-wrap\",\n        border: props.selected ? \"1px solid #3E5C6B\" : undefined,\n        color: \"rgba(0, 0, 0, 0.8)\",\n        fontSize: \"16px\",\n        backgroundColor: \"rgba(250, 250, 250, 0.4)\",\n        padding: 10,\n        borderRadius: 10,\n        userSelect: 'none',\n        cursor: \"pointer\"\n    })\n);\n\nexport const ActionTextContentStyled = Glamorous.div<{ selected?: boolean }>(\n    props => ({\n        whiteSpace: \"pre-wrap\",\n        color: \"rgba(0, 0, 0, 0.8)\",\n        fontSize: \"16px\",\n        backgroundColor: \"rgba(250, 250, 250, 0.4)\",\n        padding: 10,\n        userSelect: 'none',\n        borderRadius: 10\n    })\n);\n\nexport const Input = Glamorous.input({\n    minHeight: 24,\n    outline: 0,\n    borderWidth: '0 0 0px',\n    backgroundColor: 'transparent',\n    fontSize: 16,\n    minWidth: 50,\n    lineHeight: 1.5,\n    appearance: 'none',\n});\n\n","import * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport * as THREE from 'three';\nimport { FlexLayout } from \"../ui/ui\";\nexport const isChromium = (window as any).chrome;\n\nexport const SceneContext = React.createContext<{ scene: THREE.Scene, cam: THREE.PerspectiveCamera, subscribeTicks: (listener: () => void) => () => void }>({} as any);\n\nexport class Scene extends React.PureComponent<{}, { scene?: THREE.Scene, cam?: THREE.PerspectiveCamera }> {\n    ref = React.createRef<HTMLDivElement>();\n    scene?: THREE.Scene;\n    cam?: THREE.PerspectiveCamera;\n    renderer?: THREE.WebGLRenderer;\n    frameId?: number;\n    minSceneCamZ = 500;\n\n    tickListeners = new Set<() => void>();\n    constructor(props: any) {\n        super(props);\n        this.state = {};\n    }\n\n    subscribeTicks = (listener: () => void) => {\n        this.tickListeners.add(listener);\n        return () => {\n            this.tickListeners.delete(listener);\n        }\n    }\n\n    componentDidMount() {\n\n        if (this.ref.current) {\n            let e = ReactDOM.findDOMNode(this.ref.current) as Element;\n            const width = e.clientWidth\n            const height = e.clientHeight\n            //ADD SCENE\n            this.scene = new THREE.Scene()\n            //ADD CAMERAS\n            this.cam = new THREE.PerspectiveCamera(\n                75,\n                width / height,\n                0.1,\n                // so bad\n                Number.MAX_SAFE_INTEGER\n            )\n            this.cam.position.z = this.minSceneCamZ;\n            this.cam.position.y = -500;\n\n            const color = 0xFFFFFF;\n            const intensity = 1;\n            const light = new THREE.DirectionalLight(color, intensity);\n            light.position.set(0, 10, 400);\n            light.target.position.set(5, 500, 200);\n            this.scene.add(light);\n            this.scene.add(light.target);\n\n            //ADD RENDERER\n            this.renderer = new THREE.WebGLRenderer({ antialias: true })\n            this.renderer.setClearColor('#ffffff')\n            this.renderer.setSize(width, height)\n            e.appendChild(this.renderer.domElement)\n\n            var gridHelper = new THREE.GridHelper(100000, 1000);\n            gridHelper.rotateX(1.5708);\n            this.scene.add(gridHelper);\n            this.start()\n\n            this.setState({ scene: this.scene, cam: this.cam });\n        }\n\n    }\n    componentWillUnmount() {\n        this.stop()\n        // this.ref.removeChild(this.renderer.domElement)\n    }\n    start = () => {\n        if (!this.frameId) {\n            this.frameId = requestAnimationFrame(this.tick)\n        }\n    }\n    stop = () => {\n        cancelAnimationFrame(this.frameId!)\n    }\n    tick = () => {\n        this.tickListeners.forEach(l => l());\n        this.renderScene()\n        this.frameId = window.requestAnimationFrame(this.tick)\n    }\n\n\n    renderScene = () => {\n        this.renderer!.render(this.scene!, this.cam!);\n    }\n    render() {\n        return (\n            <SceneContext.Provider value={{ scene: this.state.scene!, cam: this.state.cam!, subscribeTicks: this.subscribeTicks }}>\n                <div\n                    style={{ width: window.innerWidth, height: window.innerHeight }}\n                    ref={this.ref}\n                />\n                <FlexLayout style={{ width: '100%', height: '100%', position: 'absolute' }}>\n                    {this.state.cam && this.state.scene && this.props.children}\n                </FlexLayout>\n            </SceneContext.Provider>\n        )\n    }\n}","import * as React from \"react\";\nimport { SessionState } from \"../../server/src/session/Session\";\nimport { SessionContext } from \"../App\";\nimport { ClientUser } from \"../../server/src/user/User\";\nimport { Button, Input, FlexLayout } from \"../ui/ui\";\nimport { GameState } from \"../model/GameModel\";\nimport { ClientQuestion } from \"../../server/src/game/Game\";\n\n\nexport const SessionStateComponent = () => {\n    let [state, setState] = React.useState<{ state: SessionState | 'connecting', ttl: number }>({ state: 'connecting', ttl: 0 });\n    let [timeout, setTimeout] = React.useState(0);\n    let [loading, setLoading] = React.useState(false);\n    let session = React.useContext(SessionContext);\n    React.useEffect(() => {\n        let dispose = session!.subscribeSessionState(s => {\n            setLoading(false);\n            setState(s);\n        });\n        return dispose;\n    }, [session]);\n\n    React.useEffect(() => {\n        let interval = setInterval(() => {\n            let left = state.ttl - new Date().getTime();\n            setTimeout(left);\n            if (left <= 0) {\n                clearInterval(interval);\n            }\n        }, 100);\n    }, [state.ttl]);\n\n    let startStop = React.useCallback(() => {\n        setLoading(true);\n        if (state.state === 'await') {\n            session!.io.emit({ type: 'SessionStartGameCountdown', id: session!.id })\n        } else {\n            session!.io.emit({ type: 'SessionStopGameCountdown', id: session!.id })\n        }\n    }, [state.state]);\n\n    let reset = React.useCallback(() => {\n        session!.io.emit({ type: 'SessionReset', id: session!.id })\n    }, [state.state]);\n\n    return <FlexLayout style={{ position: 'absolute', height: '100%', width: '100%', zIndex: 100 }}>\n        <Profile />\n\n        {(state.state === 'await' || state.state === 'countdown') &&\n            <Button\n                onClick={startStop}\n                style={{\n                    opacity: loading ? 0.5 : 1,\n                    position: 'fixed',\n                    bottom: 20,\n                    left: 20,\n                    right: 20,\n                    fontSize: 120,\n                }} >\n                {state.state === 'await' ? 'start' : Math.floor(Math.max(0, (state.ttl - new Date().getTime()) / 1000))}\n            </Button>}\n        {/* <Button onClick={reset} >RESET</Button> */}\n    </FlexLayout>\n}\n\nexport const Users = () => {\n    let [state, setState] = React.useState<Map<string, ClientUser>>(new Map());\n    let session = React.useContext(SessionContext);\n    React.useEffect(() => {\n        let dispose = session!.subscribeUsers(s => {\n            setState(s);\n        });\n        return dispose;\n    }, [session]);\n\n    return <>{JSON.stringify(Array.from(state))}</>\n}\n\nexport const Profile = () => {\n    let [me, setMe] = React.useState<ClientUser>();\n    let session = React.useContext(SessionContext);\n    React.useEffect(() => {\n        let dispose = session!.subscribeMeUser(s => {\n            setMe(s);\n        });\n        return dispose;\n    }, [session]);\n\n    let onChange = React.useCallback((event: React.ChangeEvent<HTMLInputElement>) => {\n        session!.io.emit({ type: 'UserRename', name: event.target.value })\n    }, []);\n\n    return <Input style={{ alignSelf: 'strech', textAlign: 'center', fontSize: 50, padding: 20 }} defaultValue={me ? me.name : ''} onChange={onChange} placeholder=\"Your Name\" />;\n}\n\n\nexport const AnswerText = (props: { answers: string[], onPick: (answer: string) => void }) => {\n    const [answer, setAnsser] = React.useState<string>();\n\n    const onPick = React.useCallback((answer: string) => {\n        setAnsser(answer);\n        props.onPick(answer);\n    }, []);\n    return <>\n        {props.answers.map((a) => <Button style={{\n            backgroundColor: a === answer ? 'black' : 'white',\n            color: a === answer ? 'white' : 'black',\n        }} onClick={() => onPick(a)}>{a}</Button>)}\n    </>\n}\n\nexport const AnswerOpen = (props: { onPick: (answer: string) => void }) => {\n    const [answer, setAnsser] = React.useState<string>();\n    const onPick = React.useCallback((event: React.ChangeEvent<HTMLInputElement>) => {\n        let a = event.target.value;\n        setAnsser(a);\n        props.onPick(a);\n    }, []);\n    return <>\n        <Input style={{ border: '1px solid black', borderRadius: 8 }} onChange={onPick} />\n    </>\n}\n\nexport const Question = (props: { q: ClientQuestion, gid: string }) => {\n    const [answer, setAnsser] = React.useState<string>();\n    const [submited, setSubmited] = React.useState(false);\n    const onPick = React.useCallback((answer: string) => {\n        setAnsser(answer);\n    }, []);\n    let session = React.useContext(SessionContext);\n\n    const onSubmit = React.useCallback(() => {\n        if (!answer || submited) {\n            return;\n        }\n        session!.io.emit({ type: 'Answer', gid: props.gid, answer, qid: props.q._id });\n        setSubmited(true);\n    }, [answer]);\n    return <>\n\n        <FlexLayout style={{ pointerEvents: submited ? 'none' : 'auto' }} >\n            {props.q.open && <AnswerOpen onPick={onPick} />}\n            {props.q.textAnswers && <AnswerText answers={props.q.textAnswers} onPick={onPick} />}\n        </FlexLayout>\n\n        <Button onClick={onSubmit} style={{\n            opacity: !answer || submited ? 0.5 : 1,\n            color: 'white',\n            fontSize: '22px',\n            background: 'black',\n            position: 'fixed', bottom: 20, right: 20,\n            borderRadius: 48,\n            width: 148,\n            height: 48,\n        }}>{submited ? 'ANSWERED' : 'SUBMIT'}</Button>\n\n    </>\n}\n\nexport const Game = () => {\n    let session = React.useContext(SessionContext);\n    let [state, setState] = React.useState<GameState>(session!.game.state);\n    let [timeout, setTimeout] = React.useState(0);\n\n    let aspect = window.innerWidth / (440 + 20);\n    let offset = (310 + 20) * aspect;\n\n    React.useEffect(() => {\n        let dispose = session!.game.listen(s => {\n            setState(s);\n            // setState({\n            //     ...s, question: {\n            //         text: 'wop wop',\n            //         _id: 'asd',\n            //         category: 'asda',\n            //         open: 'text'\n            //         // textAnswers: ['1', ' asd', '12', 'dd asd', '3', '1', ' asd', '12', 'dd asd', '3']\n            //     },\n            //     state: 'question'\n            // });\n        });\n        return dispose;\n    }, [session]);\n\n    React.useEffect(() => {\n        let interval = setInterval(() => {\n            let left = state.ttl - new Date().getTime();\n            setTimeout(left);\n            if (left <= 0) {\n                clearInterval(interval);\n            }\n        }, 100);\n    }, [state.ttl]);\n\n    return <>\n        <FlexLayout style={{ position: 'absolute', height: '100%', width: '100%', overflowY: 'scroll' }} divider={0}>\n            <FlexLayout style={{ height: offset }} divider={0} >\n                {/* <Button onClick={() => {\n                    setState({ ...state, state: state.state === 'question' ? 'subResults' : 'question' })\n                }}> asdasd</Button> */}\n            </FlexLayout>\n            {state.state === 'question' && state.question && <FlexLayout style={{ flexGrow: 1, backgroundColor: 'rgba(100,100,100, 0.5)', padding: 20, paddingBottom: 68 }} divider={0}>\n                <Question key={state.question._id} q={state.question} gid={state.id!} />\n            </FlexLayout>}\n        </FlexLayout>\n    </>;\n}","import * as THREE from 'three';\nimport * as React from \"react\";\nimport { Vector3, ExtrudeGeometry } from 'three';\nimport { SceneContext } from './Scene';\nimport { MeshText2D, textAlign } from 'three-text2d'\n\nexport const useAddMeshRemove = (mesh: THREE.Mesh | THREE.Mesh[]) => {\n    let scene = React.useContext(SceneContext);\n    React.useEffect(() => {\n        let toRemove = Array.isArray(mesh) ? mesh : [mesh];\n        if (scene.scene) {\n            scene.scene.add(...toRemove);\n        }\n        return () => {\n            if (scene.scene) {\n                scene.scene.remove(...toRemove);\n            }\n        }\n    }, [])\n}\n\nexport const getCube = () => {\n    const geometry = new THREE.BoxGeometry(100, 100, 100);;\n    const material = new THREE.MeshLambertMaterial({ color: \"#ff00ee\" })\n    return new THREE.Mesh(geometry, material)\n}\n\nexport const getCard = () => {\n    var height = 440, width = 310, radius = 40;\n\n    var shape = new THREE.Shape();\n\n\n    shape.moveTo(0, height / 2);\n    shape.lineTo(0, height - radius);\n    shape.absarc(radius, height - radius, radius, THREE.Math.degToRad(180), THREE.Math.degToRad(90), true);\n    shape.lineTo(width - radius, height);\n    shape.absarc(width - radius, height - radius, radius, THREE.Math.degToRad(90), THREE.Math.degToRad(0), true);\n    shape.lineTo(width, radius);\n    shape.absarc(width - radius, radius, radius, THREE.Math.degToRad(0), THREE.Math.degToRad(270), true);\n    shape.lineTo(radius, 0);\n    shape.absarc(radius, radius, radius, THREE.Math.degToRad(270), THREE.Math.degToRad(180), true);\n    shape.lineTo(0, height / 2);\n\n\n\n    var geometry = new THREE.ExtrudeGeometry(shape, {\n        steps: 1,\n        depth: 3,\n        bevelEnabled: false,\n    });\n    var material = new THREE.MeshLambertMaterial({ color: 0xffffff });\n\n    let mesh = new THREE.Mesh(geometry, material);\n\n\n\n    mesh.geometry.center();\n\n    let text = getTextMesh({ width: 440, height: 310, text: 'Q?', fontSize: 440, font: 'Courier', bold: true, x: 200, y: -85 })\n    mesh.add(text);\n    text.position.z = 2;\n    text.rotation.z = THREE.Math.degToRad(90);\n\n    return mesh;\n}\n\nexport let wrapText = (context: CanvasRenderingContext2D, text: string, maxWidth: number, lineHeight: number, color: string, height: number, padding: number, x?: number, y?: number) => {\n    var words = text.split(' ');\n    var line = '';\n    context.fillStyle = color;\n\n    let lines: string[] = [];\n    let realWidth = 0;\n    for (let n = 0; n < words.length; n++) {\n        var testLine = line + words[n] + ' ';\n        var testMetrics = context.measureText(testLine);\n        if (testMetrics.width > maxWidth - (padding * 2) && n > 0) {\n            // context.fillText(line, x, y);\n            lines.push(line);\n            var realMetrics = context.measureText(line);\n            realWidth = Math.max(realWidth, realMetrics.width);\n            line = words[n] + ' ';\n\n\n        }\n        else {\n            line = testLine;\n        }\n    }\n    var realMetrics = context.measureText(line);\n\n    lines.push(line);\n    realWidth = Math.max(realWidth, realMetrics.width);\n\n    let startY = lineHeight + (height - lineHeight * lines.length) / 2 + (y || 0);\n    let startX = (maxWidth - realWidth) / 2;\n    for (let i = 0; i < lines.length; i++) {\n        context.fillText(lines[i], startX, startY + lineHeight * i);\n    }\n}\nexport let getTextMesh = (props: { width: number, height: number, text: string, fontSize: number, padding?: number, color?: string, font?: string, bold?: boolean, x?: number, y?: number }) => {\n    let { width, height, text, fontSize, padding, color, font, bold, x, y } = props;\n    padding = padding || 0;\n    color = color || 'black';\n    font = font || 'Arial';\n    let canvas = document.createElement('canvas');\n    canvas.width = width * devicePixelRatio;\n    canvas.height = height * devicePixelRatio;\n\n    var context = canvas.getContext('2d')!;\n    context.scale(devicePixelRatio, devicePixelRatio);\n    var maxWidth = width;\n    var lineHeight = fontSize;\n    context.font = `${bold ? 'bold' : ''} ${fontSize}px ${font}`;\n    // context.fillStyle = '#f9e'\n    context.fillStyle = 'rgba(0,0,0,0)'\n    context.fillRect(0, 0, 1000, 1000);\n    wrapText(context, text, maxWidth, lineHeight, color, height, padding, x, y);\n\n    var texture = new THREE.Texture(canvas);\n    texture.needsUpdate = true;\n    texture.minFilter = THREE.LinearFilter;\n\n    let material = new THREE.MeshLambertMaterial({ map: texture, transparent: true });\n\n    var mesh = new THREE.Mesh(new THREE.PlaneGeometry(width, height, 10, 10), material);\n    canvas.remove();\n\n    return mesh;\n}\n\n","import * as THREE from 'three';\nimport * as React from \"react\";\nimport { Scene, SceneContext } from \"./Scene\";\nimport BezierEasing from 'bezier-easing';\n\nexport const interpolate = (from: number, to: number, i: number) => {\n    return (from + (to - from) * i);\n}\n\nexport const useAnimation = (mesh: THREE.Mesh) => {\n\n    let scene = React.useContext(SceneContext);\n\n    let [animation, setAnimation] = React.useState<{ to: { position?: THREE.Vector3, rotation?: THREE.Vector3 }, from: { position: THREE.Vector3, rotation: THREE.Vector3 }, start: number, end: number, rcb?: BezierEasing.EasingFunction, pcb?: BezierEasing.EasingFunction }>({ to: {}, from: {} as any, start: 0, end: 0 });\n\n    let to = React.useCallback((to: { position?: THREE.Vector3, rotation?: THREE.Vector3, rcb?: [number, number, number, number], pcb?: [number, number, number, number] }, duration: number) => {\n        let now = new Date().getTime();\n        setAnimation({ to, from: { position: mesh.position.clone(), rotation: mesh.rotation.toVector3() }, start: now, end: now + duration, rcb: to.rcb ? BezierEasing(...to.rcb) : undefined, pcb: to.pcb ? BezierEasing(...to.pcb) : undefined });\n    }, []);\n\n    React.useEffect(() => {\n        let dispose = scene.subscribeTicks(() => {\n            let time = new Date().getTime();\n            let mu = time < animation.end ? ((time - animation.start) / (animation.end - animation.start)) : 1;\n\n            if (animation.to.position) {\n                let pmu = animation.pcb ? animation.pcb(mu) : mu;\n                mesh.position.x = interpolate(animation.from.position.x, animation.to.position.x, pmu);\n                mesh.position.y = interpolate(animation.from.position.y, animation.to.position.y, pmu);\n                mesh.position.z = interpolate(animation.from.position.z, animation.to.position.z, pmu);\n            }\n            if (animation.to.rotation) {\n                let rmu = animation.rcb ? animation.rcb(mu) : mu;\n                mesh.rotation.x = interpolate(animation.from.rotation.x, animation.to.rotation.x, rmu);\n                mesh.rotation.y = interpolate(animation.from.rotation.y, animation.to.rotation.y, rmu);\n                mesh.rotation.z = interpolate(animation.from.rotation.z, animation.to.rotation.z, rmu);\n            }\n\n        });\n        return () => {\n            // keep subscription till animation end\n            let time = new Date().getTime();\n            setTimeout(dispose, (animation.end || time) - time);\n            dispose();\n        }\n    }, [animation]);\n\n    return { to };\n}","export const hashCode = (s: string) => {\n    var h = 0, l = s.length, i = 0;\n    if (l > 0)\n        while (i < l)\n            h = (h << 5) - h + s.charCodeAt(i++) | 0;\n    return h;\n};","export let makeId = () => {\n    var text = \"\";\n    var possible = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\";\n\n    for (var i = 0; i < 5; i++)\n        text += possible.charAt(Math.floor(Math.random() * possible.length));\n\n    return text;\n}","import * as THREE from 'three';\nimport * as React from \"react\";\nimport { SessionContext } from \"../App\";\nimport { ClientQuestion } from \"../../server/src/game/Game\";\nimport { Scene, SceneContext } from \"./Scene\";\nimport { SessionStateComponent, Game as GameControls } from \"./Controls\";\nimport { getCard, getTextMesh } from \"./Helpers\";\nimport { Vector3 } from \"three\";\nimport { useAnimation } from './useAnimation';\nimport { hashCode } from '../utils/hashCode';\nimport { makeId } from '../utils/makeId';\n\nexport const SessionComponent = () => {\n    return <div style={{ display: 'flex', flexDirection: 'column', width: '100%', height: '100%' }} >\n        <Scene>\n            <SceneRender />\n        </Scene>\n    </div >\n        ;\n}\n\nexport const SceneRender = () => {\n    let session = React.useContext(SessionContext)!;\n    let scene = React.useContext(SceneContext);\n    let [state, setState] = React.useState<'idle' | 'joining' | 'game'>('idle');\n\n    React.useEffect(() => {\n        let sessionState = session.sesssionState;\n        let users = session.users;\n\n        let update = () => {\n\n            if (sessionState.state === 'await' || sessionState.state === 'connecting') {\n                setState(users.size === 0 ? 'idle' : 'joining')\n            } else if (sessionState.state === 'countdown') {\n                setState('joining')\n            } else if (sessionState.state === 'game') {\n                setState('game');\n            }\n\n            console.warn(sessionState, users);\n\n        }\n\n\n\n        let sub1 = session.subscribeSessionState(s => {\n            sessionState = s;\n            update();\n        });\n        let sub2 = session.subscribeUsers(u => {\n            users = users;\n            update();\n        });\n        return () => {\n            sub1();\n            sub2();\n        }\n    }, []);\n\n    const toIdle = React.useCallback(() => { setState('idle') }, []);\n    const tojoining = React.useCallback(() => { setState('joining') }, []);\n\n    return <>\n        <div style={{ position: 'absolute', top: 0 }}>{state}</div>\n        {/* <Idle active={state === 'idle'} /> */}\n        {/* <Button style={{ border: state === 'idle' ? '1px solid black' : '' }} onClick={toIdle}>Idle</Button>\n        <Button style={{ border: state === 'joining' ? '1px solid black' : '' }} onClick={tojoining}>joining</Button> */}\n        {state === 'joining' && <SessionStateComponent />}\n        {state === 'game' && <GameControls />}\n        <GameRender />\n    </>\n}\n\nexport const GameCard = React.memo((props: { qid: string, category: string, question?: ClientQuestion, active: boolean, index: number }) => {\n    let session = React.useContext(SessionContext)!;\n    let scene = React.useContext(SceneContext);\n\n    let [card] = React.useState(getCard());\n    React.useEffect(() => {\n\n\n        card.position.z = props.index * 6;\n        card.rotation.z = THREE.Math.degToRad(-45);\n\n        let positionTremor = 10;\n        let xTremor = hashCode(props.qid + 'x') % positionTremor - positionTremor / 2;\n        card.position.x += xTremor;\n        let yTremor = hashCode(props.qid + 'y') % positionTremor - positionTremor / 2;\n        card.position.y += yTremor;\n\n        let rotationTremor = THREE.Math.degToRad(5);\n        let zTremor = hashCode(props.qid + 'z') % rotationTremor - rotationTremor / 2;\n        card.rotation.z += zTremor;\n\n        scene.scene.add(card);\n        return () => {\n            scene.scene.remove(card);\n        }\n    }, []);\n\n    let { to: cardAnimatTo } = useAnimation(card);\n\n    React.useEffect(() => {\n        if (props.question!!) {\n            if (props.active) {\n\n                // find position infront of cam\n                let base = 310 + 20;\n                let vertAngle = THREE.Math.degToRad(90 - scene.cam.fov / 2);\n                let distanceV = base / 2 * Math.tan(vertAngle);\n\n                let horisontalBase = (base * scene.cam.aspect) / 2;\n                let horAngle = Math.atan(distanceV / horisontalBase);\n\n                let distanveH = (440 + 20) / 2 * Math.tan(horAngle);\n\n                let mesh = new THREE.Mesh();\n                scene.cam.add(mesh);\n\n                mesh.translateZ(-Math.max(distanceV, distanveH));\n\n                if (session.isMobile) {\n                    let height = 2 * Math.max(distanceV, distanveH) * Math.tan(THREE.Math.degToRad(scene.cam.fov / 2));\n                    // mesh.position.y -= (height - 160) / 2;\n                    mesh.position.y += (height - 310) / 2 - 10;\n                }\n\n                let targetPostion = new Vector3();\n                mesh.getWorldPosition(targetPostion);\n\n                let targetRotation = scene.cam.rotation.clone();\n                targetRotation.z += THREE.Math.degToRad(-90);\n                targetRotation.x += THREE.Math.degToRad(-180);\n\n                let targetRotationVector = targetRotation.toVector3();\n                cardAnimatTo({\n                    position: targetPostion,\n                    pcb: [.34, .24, .18, 1.06],\n                    rotation: targetRotationVector,\n                    rcb: [.42, 0, .3, 1.01]\n                }, 1000);\n\n            } else {\n                console.log(props.qid, 'animate to old');\n                cardAnimatTo({ position: new Vector3(100, 0, 700), rotation: new Vector3(THREE.Math.degToRad(-90), 0, THREE.Math.degToRad(0)) }, 200);\n            }\n\n        }\n    }, [props.question!!, props.active]);\n\n    React.useEffect(() => {\n        let text: THREE.Mesh;\n        if (props.question && props.question.text) {\n            let text = getTextMesh({\n                width: 440, height: 310,\n                text: props.question.text,\n                fontSize: 40,\n                padding: 40\n            });\n            card.add(text);\n\n            text.rotation.x = THREE.Math.degToRad(180);\n            text.rotation.z = THREE.Math.degToRad(-90);\n            text.position.z = -2;\n        }\n\n        return () => {\n            if (text) {\n                card.remove(text);\n            }\n        }\n    }, [props.question && props.question.text]);\n\n    return <></>;\n\n});\n\nexport const GameRender = () => {\n    let scene = React.useContext(SceneContext);\n    scene.cam.rotation.x = THREE.Math.degToRad(45);\n    let session = React.useContext(SessionContext);\n\n\n    // if (session!.isMobile) {\n    //     scene.cam.translateY(50);\n    // }\n\n\n    let [cards, setCards] = React.useState<{ qid: string, category: string, question?: ClientQuestion, active: boolean }[]>([]);\n\n    React.useEffect(() => {\n        session!.game.listen(gs => {\n            setCards(gs.stack);\n        });\n    }, []);\n\n    const reset = React.useCallback(() => {\n        let res = [];\n        for (let i = 0; i < 10; i++) {\n            res.push(\n                {\n                    qid: makeId(),\n                    category: new Date().getTime() + 'test',\n                    active: true,\n                    question: i === 9 ? { text: new Date().toLocaleTimeString(), _id: makeId(), category: new Date().getTime() + 'test' } : undefined,\n                }\n            );\n        }\n        setCards(res);\n    }, []);\n\n    // React.useEffect(() => {\n    //     reset();\n    // }, []);\n\n    return <>\n        {cards.map((c, i) => <GameCard key={c.qid} index={i} {...c} />)}\n    </>\n\n}\n","import React from 'react';\nimport './App.css';\nimport { SessionModel } from './model/SessionModel';\nimport { SessionComponent } from './components/SesssionComponent';\n\nexport let SessionContext = React.createContext<SessionModel | undefined>(undefined);\n\nconst App: React.FC = () => {\n  let id = window.location.pathname.split('/').filter(s => s.length)[0];\n  let session = new SessionModel(id);\n  return (\n    <SessionContext.Provider value={session}>\n      <SessionComponent />\n    </SessionContext.Provider>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}