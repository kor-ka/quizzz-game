{"version":3,"sources":["model/GameModel.ts","model/SessionModel.ts","ui/ui.tsx","components/Scene.tsx","components/Controls.tsx","components/Helpers.ts","components/useAnimation.tsx","utils/hashCode.ts","components/GameRender.tsx","components/JoiningRender.tsx","utils/spiralCoord.ts","components/SesssionComponent.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["GameModel","session","state","scores","Map","ttl","stack","setState","listeners","Set","listen","lsitener","add","delete","notify","forEach","l","handleEvent","event","notifyers","type","sesssionState","onGameStarted","reverse","map","q","qid","question","_id","active","completed","targetState","setTimeout","id","gid","user","users","get","uid","set","score","reset","this","endpoint","window","location","hostname","indexOf","Emitter","socket","emit","message","JSON","stringify","SessionModel","io","usersListeners","sesssionStateListeners","myId","me","meListeners","isMobile","game","init","socketIo","transports","reconnectionAttempts","Number","MAX_SAFE_INTEGER","on","handleBatch","open","batchRaw","batch","parse","e","n","console","log","current","index","size","notifyUser","notifyMeUser","notifyState","subscribeUsers","listener","subscribeMeUser","subscribeSessionState","Cookie","split","chrome","FlexLayout","Glamorous","div","props","display","flexDirection","flexShrink","WebkitOverflowScrolling","boxSizing","style","marginLeft","undefined","divider","marginRight","marginTop","marginBottom","ButtonInner","minWidth","color","whiteSpace","fontSize","backgroundColor","padding","paddingTop","paddingBottom","justifyContent","borderRadius","cursor","textAlign","userSelect","outline","Button","className","onClick","children","Input","border","selected","input","minHeight","borderWidth","lineHeight","appearance","SceneContext","React","Scene","ref","scene","cam","renderer","frameId","tickListeners","subscribeTicks","start","requestAnimationFrame","tick","stop","cancelAnimationFrame","renderScene","render","ReactDOM","width","clientWidth","height","clientHeight","THREE","position","z","y","rotation","x","degToRad","light","target","antialias","setClearColor","setSize","appendChild","domElement","rotateX","Provider","value","innerWidth","innerHeight","SessionStateComponent","loading","setLoading","SessionContext","s","interval","setInterval","left","Date","getTime","clearInterval","startStop","zIndex","opacity","bottom","right","Math","floor","max","Profile","setMe","onChange","name","alignSelf","defaultValue","placeholder","AnswerText","pickedAnswer","setAnsser","onPick","answer","toLowerCase","answers","a","correctAnswer","AnswerOpen","borderColor","margin","GameTTL","timeout","Question","submited","setSubmited","onSubmit","offset","overflowY","flexGrow","pointerEvents","textAnswers","background","Results","Array","from","values","sort","b","us","Game","key","getCard","shape","moveTo","lineTo","absarc","geometry","steps","depth","bevelEnabled","material","mesh","center","text","getTextMesh","font","bold","canvas","document","createElement","devicePixelRatio","context","getContext","scale","maxWidth","fillStyle","fillRect","words","line","lines","realWidth","length","testLine","measureText","push","realMetrics","startY","startX","i","fillText","wrapText","texture","needsUpdate","minFilter","transparent","remove","IN_OUT","interpolate","to","useAnimation","end","animation","setAnimation","duration","now","clone","toVector3","rcb","BezierEasing","pcb","dispose","time","mu","pmu","rmu","hashCode","h","charCodeAt","GameCard","card","cardAnimatTo","xTremor","positionTremor","yTremor","rotationTremor","zTremor","targetPostion","vertAngle","fov","distanceV","base","tan","horisontalBase","aspect","horAngle","atan","distanveH","camMesh","Mesh","copy","camGamePostion","setFromVector3","camGameRotation","updateMatrixWorld","translateZ","Vector3","getWorldPosition","targetRotation","GameRender","cards","setCards","gs","c","UserCards","coords","k","ceil","sqrt","t","m","spiralCoord","translateX","translateY","JoiningRender","setUsers","u","camAwaitPostion","camAwaitRotation","SessionComponent","SceneRender","camAnimatTo","sessionState","update","warn","sub1","sub2","createContext","App","pathname","filter","Boolean","match","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.f572b1e6.chunk.js","sourcesContent":["import { Event } from '../../server/src/entity/events';\nimport { SessionModel } from './SessionModel';\nimport { ClientUser } from '../../server/src/user/User';\nimport { ClientQuestion, GameState as State } from '../../server/src/game/Game';\n\nexport interface GameState {\n    id?: string;\n    scores: Map<string, { user: ClientUser, score: number }>;\n    question?: ClientQuestion;\n    stack: { qid: string, category: string, question?: ClientQuestion, active: boolean }[]\n    state: State | 'wait';\n    ttl: number\n}\n\nexport class GameModel {\n    session: SessionModel;\n    constructor(session: SessionModel) {\n        this.session = session;\n    }\n\n    state: GameState = { scores: new Map(), state: 'wait', ttl: 0, stack: [] };\n    setState = (state: Partial<GameState>) => {\n        this.state = { ...this.state, ...state };\n    }\n    listeners = new Set<(state: GameState) => void>();\n\n    listen = (lsitener: (state: GameState) => void) => {\n        this.listeners.add(lsitener);\n        lsitener(this.state);\n        return () => {\n            this.listeners.delete(lsitener);\n        }\n    }\n\n    notify = () => {\n        this.listeners.forEach(l => l(this.state));\n    }\n\n    handleEvent = (event: Event, notifyers: Set<() => void>) => {\n        if (event.type === 'GameStateChangedEvent') {\n            if (this.session.sesssionState.state !== 'game' && event.state === 'question') {\n                this.session.onGameStarted();\n            }\n            event.stack.reverse();\n            let stack = event.stack.map(q => {\n                let isCurretn = q.qid === (event.question && event.question._id);\n                if (isCurretn) {\n                    return { ...q, question: event.question, active: !q.completed };\n                } else {\n                    return { ...q, active: true };\n                }\n            });\n            let targetState = event.state;\n            if (targetState === 'subResults') {\n                targetState = 'question';\n                setTimeout(() => {\n                    this.setState({ state: event.state });\n                    this.notify();\n                }, 2000);\n            }\n            this.setState({ id: event.gid, question: event.question, state: targetState, ttl: event.ttl || 0, stack });\n\n            notifyers.add(this.notify);\n\n        } else if (event.type === 'GameScoreChangedEvent') {\n            let user = this.session.users.get(event.uid);\n            if (user) {\n                this.state.scores.set(event.uid, { user, score: event.score })\n                this.setState({ scores: new Map(this.state.scores) });\n            }\n            notifyers.add(this.notify);\n\n        }\n    }\n\n    reset = () => {\n        this.state = { scores: new Map(), state: 'wait', ttl: 0, stack: [] };\n        this.notify();\n    }\n\n}","import * as socketIo from 'socket.io-client';\nimport { Message } from '../../server/src/entity/messages';\nimport { ClientUser } from '../../server/src/user/User';\nimport { SessionState } from '../../server/src/session/Session';\nimport * as Cookie from 'js-cookie';\nimport { Event } from '../../server/src/entity/events';\nimport { GameModel } from './GameModel';\nexport const endpoint = window.location.hostname.indexOf('localhost') >= 0 ? 'http://localhost:5000' : '';\n\nexport type ClientUserIndexed = ClientUser & { index: number };\n\nclass Emitter {\n    socket: SocketIOClient.Socket;\n    constructor(socket: SocketIOClient.Socket) {\n        this.socket = socket;\n    }\n    emit = (message: Message) => {\n        this.socket.emit('message', JSON.stringify(message));\n    }\n}\n\nexport class SessionModel {\n    id: string;\n    io: Emitter;\n\n    users = new Map<string, ClientUserIndexed>();\n    usersListeners = new Set<(users: Map<string, ClientUserIndexed & { index: number }>) => void>();\n\n    sesssionState: { state: SessionState | 'connecting', ttl: number } = { state: 'connecting', ttl: 0 };\n    sesssionStateListeners = new Set<(sessionState: { state: SessionState | 'connecting', ttl: number }) => void>();\n\n    myId: string;\n    me?: ClientUser;\n    meListeners = new Set<(me: ClientUser) => void>();\n\n    isMobile?: boolean;\n\n    game = new GameModel(this);\n\n    constructor(id: string) {\n        this.id = id;\n        this.io = this.init();\n        this.myId = Cookie.get('quizzz-game-user')!.split(':')[0];\n\n        this.isMobile = Cookie.get('isMobile') === 'true';\n    }\n\n    init = () => {\n        let socket = socketIo(endpoint, { transports: ['websocket'], reconnectionAttempts: Number.MAX_SAFE_INTEGER });\n        let io = new Emitter(socket);\n        socket.on('event', this.handleBatch);\n        socket.on('connect', () => io.emit({ type: 'InitSession', id: this.id }));\n        socket.on('disconnect', socket.open)\n        socket.on('connect_error', socket.open)\n        socket.on('connect_timeout', socket.open)\n\n        return io;\n    }\n\n    handleBatch = (batchRaw: string) => {\n        let batch: { batch: Event[] } = JSON.parse(batchRaw);\n        let notifyers = new Set<() => void>();\n        batch.batch.forEach(e => this.handleEvent(e, notifyers));\n        notifyers.forEach(n => n());\n    }\n\n    handleEvent = (event: Event, notifyers: Set<() => void>) => {\n        console.log('[event]', event);\n        if (event.type === 'UserUpdatedEvent') {\n            let current = this.users.get(event.user._id);\n            this.users.set(event.user._id, { ...event.user, index: current ? current.index : this.users.size });\n            notifyers.add(this.notifyUser);\n            if (event.user._id === this.myId) {\n                this.me = event.user;\n                notifyers.add(this.notifyMeUser);\n            }\n        } else if (event.type === 'SessionUserJoinedEvent') {\n            let current = this.users.get(event.user._id);\n            this.users.set(event.user._id, { ...event.user, index: current ? current.index : this.users.size });\n            if (event.user._id === this.myId) {\n                this.me = event.user;\n                notifyers.add(this.notifyMeUser);\n            }\n            notifyers.add(this.notifyUser);\n        } else if (event.type === 'SessionUserLeftEvent') {\n            this.users.delete(event.user._id);\n            notifyers.add(this.notifyUser);\n        } else if (event.type === 'SessionStateChangedEvent') {\n            this.sesssionState = { state: event.state, ttl: event.ttl || 0 };\n            notifyers.add(this.notifyState);\n            if (event.state === 'await') {\n                this.game.reset();\n            }\n        }\n\n        this.game.handleEvent(event, notifyers);\n    }\n\n    onGameStarted = () => {\n        if (this.sesssionState.state === 'countdown') {\n            this.sesssionState = { state: 'game', ttl: 0 };\n            this.notifyState();\n        }\n    }\n\n    ////\n    // io\n    ////\n\n    subscribeUsers = (listener: (users: Map<string, ClientUserIndexed>) => void) => {\n        this.usersListeners.add(listener);\n        listener(this.users);\n        return () => {\n            this.usersListeners.delete(listener);\n        }\n    }\n\n    subscribeMeUser = (listener: (me: ClientUser) => void) => {\n        this.meListeners.add(listener);\n        if (this.me) { listener(this.me); }\n        return () => {\n            this.meListeners.delete(listener);\n        }\n    }\n\n    subscribeSessionState = (listener: (state: { state: SessionState | 'connecting', ttl: number }) => void) => {\n        this.sesssionStateListeners.add(listener);\n        listener(this.sesssionState);\n        return () => {\n            this.sesssionStateListeners.delete(listener);\n        }\n    }\n\n    notifyUser = () => {\n        this.usersListeners.forEach(l => l(new Map(this.users)));\n        console.log('[session]', 'new users', this.users);\n\n    }\n\n    notifyMeUser = () => {\n        this.meListeners.forEach(l => l({ ...this.me! }));\n        console.log('[session]', 'new me', this.me);\n    }\n\n    notifyState = () => {\n        this.sesssionStateListeners.forEach(l => l({ ...this.sesssionState }));\n        console.log('[session]', 'new state', this.sesssionState);\n    }\n}","import * as React from \"react\";\nimport Glamorous from \"glamorous\";\nexport const isChromium = (window as any).chrome;\n\nexport const FlexLayout = Glamorous.div<{\n    divider?: number;\n    style?: React.CSSProperties;\n}>(props => ({\n    display: \"flex\",\n    flexDirection: \"column\",\n    flexShrink: 0,\n    WebkitOverflowScrolling: \"touch\",\n    boxSizing: \"border-box\",\n    \"> *\": props.style && props.style.flexDirection === 'row' ? {\n        marginLeft: props.divider !== undefined ? props.divider : 5,\n        marginRight: props.divider !== undefined ? props.divider : 5\n    } : {\n            marginTop: props.divider !== undefined ? props.divider : 5,\n            marginBottom: props.divider !== undefined ? props.divider : 5\n        },\n    \">:first-child\": props.style && props.style.flexDirection === 'row' ? {\n        marginLeft: 0\n    } : {\n            marginTop: 0\n        },\n    \">:last-child\": props.style && props.style.flexDirection === 'row' ? {\n        marginRight: 0\n    } : {\n            marginBottom: 0\n        },\n    ...props.style\n}));\n\nexport const Landscape = Glamorous.div({\n    '@media only screen and (orientation: portrait)': {\n        display: 'none',\n    }\n});\n\nexport const Portrait = Glamorous.div({\n    '@media only screen and (orientation: landscape)': {\n        display: 'none',\n    }\n});\n\nconst ButtonInner = Glamorous.div<{ type?: 'danger' }>((props) => ({\n    minWidth: 28,\n    color: 'black',\n    whiteSpace: 'pre-wrap',\n    fontSize: '16px',\n    backgroundColor: props.type === 'danger' ? 'rgba(250, 200, 200, 0.6)' : 'rgba(250, 250, 250, 0.6)',\n    padding: 1,\n    paddingTop: 11,\n    paddingBottom: 9,\n    display: 'flex',\n    flexDirection: 'column',\n    justifyContent: 'center',\n    borderRadius: 10,\n    cursor: 'pointer',\n    textAlign: 'center',\n    userSelect: 'none',\n\n    ':focus': {\n        outline: 0\n    },\n\n}));\n\nexport const Button = (props: { className?: string, style?: React.CSSProperties, onClick?: () => void, type?: 'danger', children?: any }) => <ButtonInner type={props.type} className={props.className} style={props.style} onClick={props.onClick}>{props.children}</ButtonInner>\n\nexport const TextContentStyled = Glamorous.div<{ selected?: boolean }>(\n    props => ({\n        whiteSpace: \"pre-wrap\",\n        border: props.selected ? \"1px solid #3E5C6B\" : undefined,\n        color: \"rgba(0, 0, 0, 0.8)\",\n        fontSize: \"16px\",\n        backgroundColor: \"rgba(250, 250, 250, 0.4)\",\n        padding: 10,\n        borderRadius: 10,\n        userSelect: 'none',\n        cursor: \"pointer\"\n    })\n);\n\nexport const ActionTextContentStyled = Glamorous.div<{ selected?: boolean }>(\n    props => ({\n        whiteSpace: \"pre-wrap\",\n        color: \"rgba(0, 0, 0, 0.8)\",\n        fontSize: \"16px\",\n        backgroundColor: \"rgba(250, 250, 250, 0.4)\",\n        padding: 10,\n        userSelect: 'none',\n        borderRadius: 10\n    })\n);\n\nexport const Input = Glamorous.input({\n    minHeight: 24,\n    outline: 0,\n    borderWidth: '0 0 0px',\n    backgroundColor: 'transparent',\n    fontSize: 16,\n    minWidth: 50,\n    lineHeight: 1.5,\n    appearance: 'none',\n});\n\n","import * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport * as THREE from 'three';\nimport { FlexLayout } from \"../ui/ui\";\nexport const isChromium = (window as any).chrome;\n\nexport const SceneContext = React.createContext<{ scene: THREE.Scene, cam: THREE.PerspectiveCamera, subscribeTicks: (listener: () => void) => () => void }>({} as any);\nexport const minSceneCamZ = 500;\n\nexport class Scene extends React.PureComponent<{}, { scene?: THREE.Scene, cam?: THREE.PerspectiveCamera }> {\n    ref = React.createRef<HTMLDivElement>();\n    scene?: THREE.Scene;\n    cam?: THREE.PerspectiveCamera;\n    renderer?: THREE.WebGLRenderer;\n    frameId?: number;\n\n    tickListeners = new Set<() => void>();\n    constructor(props: any) {\n        super(props);\n        this.state = {};\n    }\n\n    subscribeTicks = (listener: () => void) => {\n        this.tickListeners.add(listener);\n        return () => {\n            this.tickListeners.delete(listener);\n        }\n    }\n\n    componentDidMount() {\n\n        if (this.ref.current) {\n            let e = ReactDOM.findDOMNode(this.ref.current) as Element;\n            const width = e.clientWidth\n            const height = e.clientHeight\n            //ADD SCENE\n            this.scene = new THREE.Scene()\n            //ADD CAMERAS\n            this.cam = new THREE.PerspectiveCamera(\n                75,\n                width / height,\n                0.1,\n                // so bad\n                Number.MAX_SAFE_INTEGER\n            )\n            this.cam.position.z = minSceneCamZ;\n            this.cam.position.y = -500;\n            this.cam.rotation.x = THREE.Math.degToRad(45);\n\n            const color = 0xFFFFFF;\n            const intensity = 1;\n            const light = new THREE.DirectionalLight(color, intensity);\n            light.position.set(0, 10, 400);\n            light.target.position.set(5, 500, 200);\n            this.scene.add(light);\n            this.scene.add(light.target);\n\n            //ADD RENDERER\n            this.renderer = new THREE.WebGLRenderer({ antialias: true })\n            this.renderer.setClearColor('#ffffff')\n            this.renderer.setSize(width, height)\n            e.appendChild(this.renderer.domElement)\n\n            var gridHelper = new THREE.GridHelper(100000, 1000);\n            gridHelper.rotateX(1.5708);\n            // this.scene.add(gridHelper);\n            this.start()\n\n            this.setState({ scene: this.scene, cam: this.cam });\n        }\n\n    }\n    componentWillUnmount() {\n        this.stop()\n        // this.ref.removeChild(this.renderer.domElement)\n    }\n    start = () => {\n        if (!this.frameId) {\n            this.frameId = requestAnimationFrame(this.tick)\n        }\n    }\n    stop = () => {\n        cancelAnimationFrame(this.frameId!)\n    }\n    tick = () => {\n        this.tickListeners.forEach(l => l());\n        this.renderScene()\n        this.frameId = window.requestAnimationFrame(this.tick)\n    }\n\n\n    renderScene = () => {\n        this.renderer!.render(this.scene!, this.cam!);\n    }\n    render() {\n        return (\n            <SceneContext.Provider value={{ scene: this.state.scene!, cam: this.state.cam!, subscribeTicks: this.subscribeTicks }}>\n                <div\n                    style={{ width: window.innerWidth, height: window.innerHeight }}\n                    ref={this.ref}\n                />\n                <FlexLayout style={{ width: '100%', height: '100%', position: 'absolute' }} divider={0}>\n                    {this.state.cam && this.state.scene && this.props.children}\n                </FlexLayout>\n            </SceneContext.Provider>\n        )\n    }\n}","import * as React from \"react\";\nimport { SessionState } from \"../../server/src/session/Session\";\nimport { SessionContext } from \"../App\";\nimport { ClientUser } from \"../../server/src/user/User\";\nimport { Button, Input, FlexLayout } from \"../ui/ui\";\nimport { GameState } from \"../model/GameModel\";\nimport { ClientQuestion } from \"../../server/src/game/Game\";\n\n\nexport const SessionStateComponent = () => {\n    let [state, setState] = React.useState<{ state: SessionState | 'connecting', ttl: number }>({ state: 'connecting', ttl: 0 });\n    let [timeout, setTimeout] = React.useState(0);\n    let [loading, setLoading] = React.useState(false);\n    let session = React.useContext(SessionContext);\n    React.useEffect(() => {\n        let dispose = session!.subscribeSessionState(s => {\n            setLoading(false);\n            setState(s);\n        });\n        return dispose;\n    }, [session]);\n\n    React.useEffect(() => {\n        let interval = setInterval(() => {\n            let left = state.ttl - new Date().getTime();\n            setTimeout(left);\n            if (left <= 0) {\n                clearInterval(interval);\n            }\n        }, 100);\n    }, [state.ttl]);\n\n    let startStop = React.useCallback(() => {\n        setLoading(true);\n        if (state.state === 'await') {\n            session!.io.emit({ type: 'SessionStartGameCountdown', id: session!.id })\n        } else {\n            session!.io.emit({ type: 'SessionStopGameCountdown', id: session!.id })\n        }\n    }, [state.state]);\n\n    let reset = React.useCallback(() => {\n        session!.io.emit({ type: 'SessionReset', id: session!.id })\n    }, [state.state]);\n\n    return <FlexLayout style={{ position: 'absolute', height: '100%', width: '100%', zIndex: 100 }} divider={0}>\n        <Profile />\n\n        {(state.state === 'await' || state.state === 'countdown') &&\n            <Button\n                onClick={startStop}\n                style={{\n                    opacity: loading ? 0.5 : 1,\n                    position: 'fixed',\n                    bottom: 20,\n                    left: 20,\n                    right: 20,\n                    fontSize: 120,\n                }} >\n                {state.state === 'await' ? 'start' : Math.floor(Math.max(0, (state.ttl - new Date().getTime()) / 1000))}\n            </Button>}\n        {/* <Button onClick={reset} >RESET</Button> */}\n    </FlexLayout>\n}\n\nexport const Users = () => {\n    let [state, setState] = React.useState<Map<string, ClientUser>>(new Map());\n    let session = React.useContext(SessionContext);\n    React.useEffect(() => {\n        let dispose = session!.subscribeUsers(s => {\n            setState(s);\n        });\n        return dispose;\n    }, [session]);\n\n    return <>{JSON.stringify(Array.from(state))}</>\n}\n\nexport const Profile = () => {\n    let [me, setMe] = React.useState<ClientUser>();\n    let session = React.useContext(SessionContext);\n    React.useEffect(() => {\n        let dispose = session!.subscribeMeUser(s => {\n            setMe(s);\n        });\n        return dispose;\n    }, [session]);\n\n    let onChange = React.useCallback((event: React.ChangeEvent<HTMLInputElement>) => {\n        session!.io.emit({ type: 'UserRename', name: event.target.value })\n    }, []);\n\n    return <Input style={{ alignSelf: 'strech', textAlign: 'center', fontSize: 50, padding: 20, backgroundColor: 'rgba(100,100,100, 0.5)' }} defaultValue={me ? me.name : ''} onChange={onChange} placeholder=\"Your Name\" />;\n}\n\n\nexport const AnswerText = (props: { answers: string[], correctAnswer?: string, onPick: (answer: string) => void }) => {\n    const [pickedAnswer, setAnsser] = React.useState<string>();\n\n    const onPick = React.useCallback((answer: string) => {\n        setAnsser(answer.toLowerCase());\n        props.onPick(answer);\n    }, []);\n\n    return <>\n        {props.answers.map((a) => <Button style={{\n            backgroundColor:\n                a === props.correctAnswer ? 'limegreen' :\n                    a === pickedAnswer ? (props.correctAnswer ? 'red' : 'black')\n                        : 'white'\n        }} onClick={() => onPick(a)}>{a}</Button>)\n        }\n    </>\n}\n\nexport const AnswerOpen = (props: { correctAnswer?: string, onPick: (answer: string) => void }) => {\n    const [answer, setAnsser] = React.useState<string>();\n    const onPick = React.useCallback((event: React.ChangeEvent<HTMLInputElement>) => {\n        let a = event.target.value;\n        setAnsser(a.toLowerCase());\n        props.onPick(a);\n    }, []);\n    let borderColor = props.correctAnswer === undefined ? 'black' :\n        props.correctAnswer === answer ? 'limegreen' : 'maroon';\n    return <>\n        <Input style={{ border: `1px solid ${borderColor}`, borderRadius: 8 }} onChange={onPick} />\n        {props.correctAnswer && props.correctAnswer !== answer &&\n            <span style={{ padding: 20, margin: 20, backgroundColor: 'rgba(100,100,100, 0.5)', borderRadius: 20, color: 'limegreen' }}>{props.correctAnswer}</span>\n        }\n    </>\n}\n\nexport const GameTTL = () => {\n    let session = React.useContext(SessionContext);\n    let [timeout, setTimeout] = React.useState(0);\n    let [state, setState] = React.useState<GameState>(session!.game.state);\n\n    React.useEffect(() => {\n        let dispose = session!.game.listen(s => {\n            setState(s);\n        });\n        return dispose;\n    }, [session]);\n    React.useEffect(() => {\n        let interval = setInterval(() => {\n            let left = Math.floor(Math.max(0, (state.ttl - new Date().getTime()) / 1000));\n            setTimeout(left);\n            if (left <= 0) {\n                clearInterval(interval);\n            }\n        }, 100);\n    }, [state.ttl]);\n\n    return <>{timeout}</>;\n}\n\nexport const Question = (props: { q: ClientQuestion, gid: string }) => {\n    const [answer, setAnsser] = React.useState<string>();\n    const [submited, setSubmited] = React.useState(false);\n    const onPick = React.useCallback((answer: string) => {\n        setAnsser(answer);\n    }, []);\n    let session = React.useContext(SessionContext);\n\n    const onSubmit = React.useCallback(() => {\n        if (!answer || submited) {\n            return;\n        }\n        session!.io.emit({ type: 'Answer', gid: props.gid, answer, qid: props.q._id });\n        setSubmited(true);\n    }, [answer]);\n\n    let aspect = window.innerWidth / (440 + 20);\n    let offset = (310 + 20) * aspect;\n    return <>\n\n        <FlexLayout style={{ position: 'absolute', height: '100%', width: '100%', overflowY: 'scroll' }} divider={0}>\n\n            <FlexLayout style={{ height: offset }} divider={0} >\n                {/* <Button onClick={() => {\n        setState({ ...state, state: state.state === 'question' ? 'subResults' : 'question' })\n    }}> asdasd</Button> */}\n            </FlexLayout>\n            <FlexLayout style={{ flexGrow: 1, backgroundColor: 'rgba(100,100,100, 0.5)', padding: 20, paddingBottom: 68 }} divider={0}>\n                <FlexLayout style={{ pointerEvents: submited ? 'none' : 'auto' }} >\n                    {props.q.open && <AnswerOpen correctAnswer={props.q.answer} onPick={onPick} />}\n                    {props.q.textAnswers && <AnswerText answers={props.q.textAnswers} correctAnswer={props.q.answer} onPick={onPick} />}\n                </FlexLayout>\n\n                <Button onClick={onSubmit} style={{\n                    opacity: !answer || submited ? 0.5 : 1,\n                    color: 'white',\n                    fontSize: '22px',\n                    background: 'black',\n                    position: 'fixed', bottom: 20, right: 20,\n                    borderRadius: 48,\n                    width: 148,\n                    height: 48,\n                }}>{submited ? 'ANSWERED' : 'SUBMIT'}</Button>\n\n                <Button style={{\n                    backgroundColor: 'transparent',\n                    opacity: 0.5,\n                    color: 'black',\n                    fontSize: '22px',\n                    position: 'fixed',\n                    bottom: 20, left: 20,\n                    borderRadius: 48,\n                    width: 148,\n                    height: 48,\n                    textAlign: 'left'\n\n                }}><GameTTL /></Button>\n\n            </FlexLayout>\n        </FlexLayout>\n\n    </>\n}\n\nexport const Results = (props: { game: GameState }) => {\n    return <FlexLayout style={{ height: '100%', width: '100%', padding: 20, overflowY: 'scroll' }}>\n        {Array.from(props.game.scores.values()).sort((a, b) => b.score - a.score).map(us => {\n            return <FlexLayout style={{ padding: 20, backgroundColor: 'rgba(100,100,100, 0.5)', borderRadius: 20 }}>{us.user.name + ': ' + us.score}</FlexLayout>\n        })}\n        <Button style={{\n            backgroundColor: 'transparent',\n            opacity: 0.5,\n            color: 'black',\n            fontSize: '22px',\n            position: 'fixed',\n            bottom: 20, left: 20,\n            borderRadius: 48,\n            width: 148,\n            height: 48,\n            textAlign: 'left'\n\n        }}><GameTTL /></Button>\n    </FlexLayout>\n}\n\nexport const Game = () => {\n    let session = React.useContext(SessionContext);\n    let [state, setState] = React.useState<GameState>(session!.game.state);\n\n\n\n    React.useEffect(() => {\n        let dispose = session!.game.listen(s => {\n            setState(s);\n            // setState({\n            //     ...s, question: {\n            //         text: 'wop wop',\n            //         _id: 'asd',\n            //         category: 'asda',\n            //         open: 'text'\n            //         // textAnswers: ['1', ' asd', '12', 'dd asd', '3', '1', ' asd', '12', 'dd asd', '3']\n            //     },\n            //     state: 'question'\n            // });\n        });\n        return dispose;\n    }, [session]);\n\n\n    return <>\n        {session!.isMobile && state.state === 'question' && state.question && <Question key={state.question._id} q={state.question} gid={state.id!} />}\n        {(state.state === 'subResults' || state.state === 'results') && <Results game={state} />}\n        {!session!.isMobile && (\n            <Button style={{\n                backgroundColor: 'transparent',\n                opacity: 0.5,\n                color: 'black',\n                fontSize: '22px',\n                position: 'fixed',\n                bottom: 20, left: 20,\n                borderRadius: 48,\n                width: 148,\n                height: 48,\n                textAlign: 'left'\n\n            }}><GameTTL /></Button>\n        )}\n    </>;\n}","import * as THREE from 'three';\nimport * as React from \"react\";\nimport { Vector3, ExtrudeGeometry } from 'three';\nimport { SceneContext } from './Scene';\nimport { MeshText2D, textAlign } from 'three-text2d'\n\nexport const useAddMeshRemove = (mesh: THREE.Mesh | THREE.Mesh[]) => {\n    let scene = React.useContext(SceneContext);\n    React.useEffect(() => {\n        let toRemove = Array.isArray(mesh) ? mesh : [mesh];\n        if (scene.scene) {\n            scene.scene.add(...toRemove);\n        }\n        return () => {\n            if (scene.scene) {\n                scene.scene.remove(...toRemove);\n            }\n        }\n    }, [])\n}\n\nexport const getCube = () => {\n    const geometry = new THREE.BoxGeometry(100, 100, 100);;\n    const material = new THREE.MeshLambertMaterial({ color: \"#ff00ee\" })\n    return new THREE.Mesh(geometry, material)\n}\n\nexport const getCard = () => {\n    var height = 440, width = 310, radius = 40;\n\n    var shape = new THREE.Shape();\n\n\n    shape.moveTo(0, height / 2);\n    shape.lineTo(0, height - radius);\n    shape.absarc(radius, height - radius, radius, THREE.Math.degToRad(180), THREE.Math.degToRad(90), true);\n    shape.lineTo(width - radius, height);\n    shape.absarc(width - radius, height - radius, radius, THREE.Math.degToRad(90), THREE.Math.degToRad(0), true);\n    shape.lineTo(width, radius);\n    shape.absarc(width - radius, radius, radius, THREE.Math.degToRad(0), THREE.Math.degToRad(270), true);\n    shape.lineTo(radius, 0);\n    shape.absarc(radius, radius, radius, THREE.Math.degToRad(270), THREE.Math.degToRad(180), true);\n    shape.lineTo(0, height / 2);\n\n\n\n    var geometry = new THREE.ExtrudeGeometry(shape, {\n        steps: 1,\n        depth: 3,\n        bevelEnabled: false,\n    });\n    var material = new THREE.MeshLambertMaterial({ color: 0xffffff });\n\n    let mesh = new THREE.Mesh(geometry, material);\n\n\n\n    mesh.geometry.center();\n\n    let text = getTextMesh({ width: 440, height: 310, text: 'Q?', fontSize: 440, font: 'Courier', bold: true, x: 200, y: -85 })\n    mesh.add(text);\n    text.position.z = 3;\n    text.rotation.z = THREE.Math.degToRad(90);\n\n    return mesh;\n}\n\nexport let wrapText = (context: CanvasRenderingContext2D, text: string, maxWidth: number, lineHeight: number, color: string, height: number, padding: number, x?: number, y?: number) => {\n    var words = text.split(' ');\n    var line = '';\n    context.fillStyle = color;\n\n    let lines: string[] = [];\n    let realWidth = 0;\n    for (let n = 0; n < words.length; n++) {\n        var testLine = line + words[n] + ' ';\n        var testMetrics = context.measureText(testLine);\n        if (testMetrics.width > maxWidth - (padding * 2) && n > 0) {\n            // context.fillText(line, x, y);\n            lines.push(line);\n            var realMetrics = context.measureText(line);\n            realWidth = Math.max(realWidth, realMetrics.width);\n            line = words[n] + ' ';\n\n\n        }\n        else {\n            line = testLine;\n        }\n    }\n    var realMetrics = context.measureText(line);\n\n    lines.push(line);\n    realWidth = Math.max(realWidth, realMetrics.width);\n\n    let startY = lineHeight + (height - lineHeight * lines.length) / 2 + (y || 0);\n    let startX = (maxWidth - realWidth) / 2 + (x || 0);\n    for (let i = 0; i < lines.length; i++) {\n        context.fillText(lines[i], startX, startY + lineHeight * i);\n    }\n}\nexport let getTextMesh = (props: { width: number, height: number, text: string, fontSize: number, padding?: number, color?: string, font?: string, bold?: boolean, x?: number, y?: number }) => {\n    let { width, height, text, fontSize, padding, color, font, bold, x, y } = props;\n    padding = padding || 0;\n    color = color || 'black';\n    font = font || 'Arial';\n    let canvas = document.createElement('canvas');\n    canvas.width = width * devicePixelRatio;\n    canvas.height = height * devicePixelRatio;\n\n    var context = canvas.getContext('2d')!;\n    context.scale(devicePixelRatio, devicePixelRatio);\n    var maxWidth = width;\n    var lineHeight = fontSize;\n    context.font = `${bold ? 'bold' : ''} ${fontSize}px ${font}`;\n    // context.fillStyle = '#f9e'\n    context.fillStyle = 'rgba(0,0,0,0)'\n    context.fillRect(0, 0, 1000, 1000);\n    wrapText(context, text, maxWidth, lineHeight, color, height, padding, x, y);\n\n    var texture = new THREE.Texture(canvas);\n    texture.needsUpdate = true;\n    texture.minFilter = THREE.LinearFilter;\n\n    let material = new THREE.MeshLambertMaterial({ map: texture, transparent: true });\n\n    var mesh = new THREE.Mesh(new THREE.PlaneGeometry(width, height, 10, 10), material);\n    canvas.remove();\n\n    return mesh;\n}\n\n","import * as THREE from 'three';\nimport * as React from \"react\";\nimport { Scene, SceneContext } from \"./Scene\";\nimport BezierEasing from 'bezier-easing';\nimport { PerspectiveCamera } from 'three';\n\nexport const IN_OUT = [.42, 0, .58, 1] as [number, number, number, number];\n\nexport const interpolate = (from: number, to: number, i: number) => {\n    return (from + (to - from) * i);\n}\n\nexport const useAnimation = (mesh: THREE.Mesh | PerspectiveCamera) => {\n\n    let scene = React.useContext(SceneContext);\n\n    let [animation, setAnimation] = React.useState<{ to: { position?: THREE.Vector3, rotation?: THREE.Vector3 }, from: { position: THREE.Vector3, rotation: THREE.Vector3 }, start: number, end: number, rcb?: BezierEasing.EasingFunction, pcb?: BezierEasing.EasingFunction }>({ to: {}, from: {} as any, start: 0, end: 0 });\n\n    let to = React.useCallback((to: { position?: THREE.Vector3, rotation?: THREE.Vector3, rcb?: [number, number, number, number], pcb?: [number, number, number, number] }, duration: number) => {\n        let now = new Date().getTime();\n        setAnimation({ to, from: { position: mesh.position.clone(), rotation: mesh.rotation.toVector3() }, start: now, end: now + duration, rcb: to.rcb ? BezierEasing(...to.rcb) : undefined, pcb: to.pcb ? BezierEasing(...to.pcb) : undefined });\n    }, []);\n\n    React.useEffect(() => {\n        let dispose = scene.subscribeTicks(() => {\n            let time = new Date().getTime();\n            let mu = time < animation.end ? ((time - animation.start) / (animation.end - animation.start)) : 1;\n\n            if (animation.to.position) {\n                let pmu = animation.pcb ? animation.pcb(mu) : mu;\n                mesh.position.x = interpolate(animation.from.position.x, animation.to.position.x, pmu);\n                mesh.position.y = interpolate(animation.from.position.y, animation.to.position.y, pmu);\n                mesh.position.z = interpolate(animation.from.position.z, animation.to.position.z, pmu);\n            }\n            if (animation.to.rotation) {\n                let rmu = animation.rcb ? animation.rcb(mu) : mu;\n                mesh.rotation.x = interpolate(animation.from.rotation.x, animation.to.rotation.x, rmu);\n                mesh.rotation.y = interpolate(animation.from.rotation.y, animation.to.rotation.y, rmu);\n                mesh.rotation.z = interpolate(animation.from.rotation.z, animation.to.rotation.z, rmu);\n            }\n\n        });\n        return () => {\n            // keep subscription till animation end\n            let time = new Date().getTime();\n            setTimeout(dispose, (animation.end || time) - time);\n            dispose();\n        }\n    }, [animation]);\n\n    return { to };\n}","export const hashCode = (s: string) => {\n    var h = 0, l = s.length, i = 0;\n    if (l > 0)\n        while (i < l)\n            h = (h << 5) - h + s.charCodeAt(i++) | 0;\n    return h;\n};","import * as THREE from 'three';\nimport * as React from \"react\";\nimport { SessionContext } from \"../App\";\nimport { ClientQuestion } from \"../../server/src/game/Game\";\nimport { SceneContext } from \"./Scene\";\nimport { getCard, getTextMesh } from \"./Helpers\";\nimport { Vector3, PerspectiveCamera, Mesh } from \"three\";\nimport { useAnimation } from './useAnimation';\nimport { hashCode } from '../utils/hashCode';\nimport { makeId } from '../utils/makeId';\nimport { camGameRotation, camGamePostion } from './SesssionComponent';\n\nexport const GameCard = React.memo((props: { qid: string, category: string, question?: ClientQuestion, active: boolean, index: number }) => {\n    let session = React.useContext(SessionContext)!;\n    let scene = React.useContext(SceneContext);\n\n    let [card] = React.useState(getCard());\n    let { to: cardAnimatTo } = useAnimation(card);\n    React.useEffect(() => {\n\n        // position above target place\n        card.position.z = props.index * 6 + 700;\n        card.rotation.z = THREE.Math.degToRad(-45);\n\n        // shake stack\n        let positionTremor = 10;\n        let xTremor = hashCode(props.qid + 'x') % positionTremor - positionTremor / 2;\n        card.position.x += xTremor;\n        let yTremor = hashCode(props.qid + 'y') % positionTremor - positionTremor / 2;\n        card.position.y += yTremor;\n\n        let rotationTremor = THREE.Math.degToRad(5);\n        let zTremor = hashCode(props.qid + 'z') % rotationTremor - rotationTremor / 2;\n        card.rotation.z += zTremor;\n\n        // drop to target position\n        let targetPostion = card.position.clone();\n        targetPostion.z -= 700;\n        cardAnimatTo({ position: targetPostion, pcb: [.74, .08, .89, .78] }, 500)\n\n        scene.scene.add(card);\n        return () => {\n            scene.scene.remove(card);\n        }\n    }, []);\n\n\n    React.useEffect(() => {\n        if (props.question!!) {\n            if (props.active) {\n\n                // find position infront of cam\n                let base = 310 + 20;\n                let vertAngle = THREE.Math.degToRad(90 - scene.cam.fov / 2);\n                let distanceV = base / 2 * Math.tan(vertAngle);\n\n                let horisontalBase = (base * scene.cam.aspect) / 2;\n                let horAngle = Math.atan(distanceV / horisontalBase);\n\n                let distanveH = (440 + 20) / 2 * Math.tan(horAngle);\n\n                let camMesh = new Mesh();\n                camMesh.position.copy(camGamePostion);\n                camMesh.rotation.setFromVector3(camGameRotation);\n                camMesh.updateMatrixWorld();\n\n                let mesh = new THREE.Mesh();\n                camMesh.add(mesh);\n                mesh.translateZ(-Math.max(distanceV, distanveH));\n\n                if (session.isMobile) {\n                    let height = 2 * Math.max(distanceV, distanveH) * Math.tan(THREE.Math.degToRad(scene.cam.fov / 2));\n                    // mesh.position.y -= (height - 160) / 2;\n                    mesh.position.y += (height - 310) / 2 - 10;\n                }\n\n                let targetPostion = new Vector3();\n                mesh.getWorldPosition(targetPostion);\n\n                let targetRotation = camGameRotation.clone();\n                targetRotation.z += THREE.Math.degToRad(-90);\n                targetRotation.x += THREE.Math.degToRad(-180);\n\n                let targetRotationVector = targetRotation;\n                cardAnimatTo({\n                    position: targetPostion,\n                    pcb: [.34, .24, .18, 1.06],\n                    rotation: targetRotationVector,\n                    rcb: [.42, 0, .3, 1.01]\n                }, 1000);\n\n            } else {\n                console.log(props.qid, 'animate to old');\n                cardAnimatTo({ position: new Vector3(100, 0, 700), rotation: new Vector3(THREE.Math.degToRad(-90), 0, THREE.Math.degToRad(0)) }, 200);\n            }\n\n        }\n    }, [props.question!!, props.active]);\n\n    React.useEffect(() => {\n        let text: THREE.Mesh;\n        if (props.question && props.question.text) {\n            let text = getTextMesh({\n                width: 440, height: 310,\n                text: props.question.text,\n                fontSize: 40,\n                padding: 40\n            });\n            card.add(text);\n\n            text.rotation.x = THREE.Math.degToRad(180);\n            text.rotation.z = THREE.Math.degToRad(-90);\n            text.position.z = -2;\n        }\n\n        return () => {\n            if (text) {\n                card.remove(text);\n            }\n        }\n    }, [props.question && props.question.text]);\n\n    return <div style={{ display: 'none' }} />;\n\n});\n\n\nexport const GameRender = () => {\n    let scene = React.useContext(SceneContext);\n    let session = React.useContext(SessionContext);\n\n    let [cards, setCards] = React.useState<{ qid: string, category: string, question?: ClientQuestion, active: boolean }[]>([]);\n\n    React.useEffect(() => {\n        scene.cam.rotation.x = THREE.Math.degToRad(45);\n        session!.game.listen(gs => {\n            setCards(gs.stack);\n        });\n    }, []);\n\n    // const reset = React.useCallback(() => {\n    //     let res = [];\n    //     for (let i = 0; i < 10; i++) {\n    //         res.push(\n    //             {\n    //                 qid: makeId(),\n    //                 category: new Date().getTime() + 'test',\n    //                 active: true,\n    //                 question: i === 9 ? { text: new Date().toLocaleTimeString(), _id: makeId(), category: new Date().getTime() + 'test' } : undefined,\n    //             }\n    //         );\n    //     }\n    //     setCards(res);\n    // }, []);\n\n    // React.useEffect(() => {\n    //     reset();\n    // }, []);\n\n    return <>\n        {cards.map((c, i) => <GameCard key={c.qid} index={i} {...c} />)}\n    </>\n\n}\n","import * as THREE from 'three';\nimport * as React from \"react\";\nimport { SessionContext } from '../App';\nimport { SceneContext } from './Scene';\nimport { getCard, getTextMesh } from './Helpers';\nimport { useAnimation } from './useAnimation';\nimport { ClientUserIndexed } from '../model/SessionModel';\nimport { spiralCoord } from '../utils/spiralCoord';\n\n\nconst UserCards = (props: { user: ClientUserIndexed }) => {\n    let scene = React.useContext(SceneContext);\n\n    let [card] = React.useState(getCard());\n    let { to: cardAnimatTo } = useAnimation(card);\n\n    React.useEffect(() => {\n\n        card.rotation.y = THREE.Math.degToRad(180);\n\n        card.position.z = 700;\n\n        let coords = spiralCoord(props.user.index + 2);\n\n        // position above target place\n        card.rotation.z = THREE.Math.degToRad(45);\n        card.translateX(coords[0] * (310 + 30));\n        card.translateY(coords[1] * (440 + 30));\n\n        // drop to target position\n        let targetPostion = card.position.clone();\n        targetPostion.z -= 700;\n        cardAnimatTo({ position: targetPostion, pcb: [.74, .08, .89, .78] }, 500)\n\n        scene.scene.add(card);\n        return () => {\n            scene.scene.remove(card);\n        }\n    }, []);\n\n    React.useEffect(() => {\n        let text = getTextMesh({\n            width: 440, height: 310,\n            text: props.user.name || '???',\n            fontSize: 40,\n            padding: 40\n        });\n        card.add(text);\n\n        text.rotation.x = THREE.Math.degToRad(180);\n        text.rotation.z = THREE.Math.degToRad(-90);\n        text.position.z = -2;\n        return () => {\n            card.remove(text);\n\n        }\n    }, [props.user.name])\n\n    return <><div style={{ display: 'none' }} /></>\n}\n\nexport const JoiningRender = () => {\n    let session = React.useContext(SessionContext)!;\n    let [users, setUsers] = React.useState<Map<string, ClientUserIndexed>>(new Map());\n    React.useEffect(() => {\n        session!.subscribeUsers(u => {\n            setUsers(u);\n            // let map = new Map<string, ClientUserIndexed>();\n            // for (let i = 0; i < 10; i++) {\n            //     map.set(i + '', { index: i, _id: i + '', name: i + '' });\n            // }\n            // setUsers(map);\n        });\n    }, []);\n\n    return <>{Array.from(users.values()).map(u => <UserCards user={u} />)}</>\n}","export const spiralCoord = (n: number) => {\n    let k = Math.ceil((Math.sqrt(n) - 1) / 2)\n    let t = 2 * k + 1;\n    let m = t * t;\n    t = t - 1;\n    if (n >= m - t) {\n        return [k - (m - n), -k]\n    } else { m = m - t }\n    if (n >= m - t) {\n        return [-k, -k + (m - n)]\n    } else { m = m - t }\n    if (n >= m - t) {\n        return [-k + (m - n), k]\n    } else {\n        return [k, k - (m - n - t)]\n    }\n}","import * as THREE from 'three';\nimport * as React from \"react\";\nimport { SessionContext } from \"../App\";\nimport { Scene, SceneContext, minSceneCamZ } from \"./Scene\";\nimport { SessionStateComponent, Game as GameControls } from \"./Controls\";\nimport { GameRender } from './GameRender';\nimport { JoiningRender } from './JoiningRender';\nimport { useAnimation, IN_OUT } from './useAnimation';\nimport { Vector3 } from 'three';\n\nexport const camGamePostion = new Vector3();\nexport const camGameRotation = new Vector3();\n\ncamGamePostion.z = minSceneCamZ;\ncamGamePostion.y = -500;\ncamGameRotation.x = THREE.Math.degToRad(45);\n\nexport const camAwaitPostion = new Vector3();\nexport const camAwaitRotation = new Vector3();\n\ncamAwaitPostion.z = 900;\ncamAwaitPostion.y = 0;\ncamAwaitRotation.x = 0;\n\n\nexport const SessionComponent = () => {\n    return <div style={{ display: 'flex', flexDirection: 'column', width: '100%', height: '100%' }} >\n        <Scene>\n            <SceneRender />\n        </Scene>\n    </div >\n        ;\n}\n\nexport const SceneRender = () => {\n    let session = React.useContext(SessionContext)!;\n    let scene = React.useContext(SceneContext);\n    let [state, setState] = React.useState<'idle' | 'joining' | 'countdown' | 'game'>('idle');\n\n    let { to: camAnimatTo } = useAnimation(scene.cam);\n\n    React.useEffect(() => {\n\n        let sessionState = session.sesssionState;\n        let users = session.users;\n\n        let update = () => {\n            if (sessionState.state === 'await' || sessionState.state === 'connecting') {\n                setState(users.size === 0 ? 'idle' : 'joining')\n            } else if (sessionState.state === 'countdown') {\n                setState('countdown')\n            } else if (sessionState.state === 'game') {\n                setState('game');\n            }\n\n            console.warn(sessionState, users);\n\n        }\n\n\n\n        let sub1 = session.subscribeSessionState(s => {\n            sessionState = s;\n            update();\n        });\n        let sub2 = session.subscribeUsers(u => {\n            users = users;\n            update();\n        });\n        return () => {\n            sub1();\n            sub2();\n        }\n    }, []);\n\n    React.useEffect(() => {\n\n        if (state === 'game' || state === 'countdown') {\n            camAnimatTo({ position: camGamePostion, rotation: camGameRotation, pcb: IN_OUT, rcb: IN_OUT }, 1000);\n        } else if (state === 'idle' || state === 'joining') {\n            camAnimatTo({ position: camAwaitPostion, rotation: camAwaitRotation, pcb: IN_OUT, rcb: IN_OUT }, 1000);\n        }\n    }, [state]);\n\n    const toIdle = React.useCallback(() => { setState('idle') }, []);\n    const tojoining = React.useCallback(() => { setState('joining') }, []);\n\n    return <>\n        {/* <div style={{ position: 'absolute', top: 0 }}>{state}</div> */}\n        {/* <Idle active={state === 'idle'} /> */}\n        {/* <Button style={{ border: state === 'idle' ? '1px solid black' : '' }} onClick={toIdle}>Idle</Button>\n        <Button style={{ border: state === 'joining' ? '1px solid black' : '' }} onClick={tojoining}>joining</Button> */}\n        {session!.isMobile && (state === 'joining' || state === 'countdown') && <SessionStateComponent />}\n        {state === 'game' && <GameControls />}\n        <GameRender />\n        <JoiningRender />\n    </>\n}","import React from 'react';\nimport './App.css';\nimport { SessionModel } from './model/SessionModel';\nimport { SessionComponent } from './components/SesssionComponent';\n\nexport let SessionContext = React.createContext<SessionModel | undefined>(undefined);\n\nconst App: React.FC = () => {\n  let id = window.location.pathname.split('/').filter(s => s.length)[0];\n  let session = new SessionModel(id);\n  return (\n    <SessionContext.Provider value={session}>\n      <SessionComponent />\n    </SessionContext.Provider>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}